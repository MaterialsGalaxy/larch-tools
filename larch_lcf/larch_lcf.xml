<tool id="larch_lcf" name="Larch LCF" version="@TOOL_VERSION@+galaxy@WRAPPER_VERSION@" python_template_version="3.5" profile="22.05" license="MIT">
    <description>perform linear combination fit on XAS data</description>
    <macros>
        <!-- version of underlying tool (PEP 440) -->
        <token name="@TOOL_VERSION@">0.9.66</token>
        <!-- version of this tool wrapper (integer) -->
        <token name="@WRAPPER_VERSION@">0</token>
        <!-- citation should be updated with every underlying tool version -->
        <!-- typical fields to update are version, month, year, and doi -->
        <token name="@TOOL_CITATION@">10.1088/1742-6596/430/1/012007</token>
    </macros>
    <creator>
        <person givenName="Patrick" familyName="Austin" url="https://github.com/patrick-austin" identifier="https://orcid.org/0000-0002-6279-7823"/>
    </creator>
    <requirements>
        <requirement type="package" version="@TOOL_VERSION@">xraylarch</requirement>
        <!-- xraydb 4.5.0 is compatible with sqlalchemy 2, but is not yet available on condaforge so pin it -->
        <requirement type="package" version="4.4.7">xraydb</requirement>
        <requirement type="package" version="1.4.46">sqlalchemy</requirement>
        <requirement type="package" version="3.5.2">matplotlib</requirement>
    </requirements>
    <required_files>
        <include type="literal" path="larch_lcf.py"/>
    </required_files>
    <command detect_errors="exit_code"><![CDATA[
        python '${__tool_directory__}/larch_lcf.py' '$prj_file' '$inputs'
    ]]></command>
    <configfiles>
        <inputs name="inputs" data_style="paths"/>
    </configfiles>
    <inputs>
        <param name="label" type="text" optional="true" label="Main data label" help="The label to use for the main data (target of the fit). If unset, the label will be taken from the Athena project metadata."/>
        <param name="prj_file" type="data" format="prj" label="Athena project to fit" help="Normalised X-ray Absorption Fine Structure (XAFS) data, in Athena project format, to be fit."/>
        <repeat name="components" title="Fit components">
            <param name="label" type="text" optional="true" label="Component label" help="The label to use for this component. If unset, the label will be taken from the Athena project metadata."/>
            <param name="component_file" type="data" format="prj" label="Athena project to fit" help="Reference X-ray Absorption Fine Structure (XAFS) data, in Athena project format, to be used as components in the fit."/>
            <param name="extract_group" type="text" optional="true" label="Extract group" help="Extract a Group nested within the project to use for the LCF. This Group should have the 'norm' attribute. If unset, the first Athena Group will be used."/>
        </repeat>
    </inputs>
    <outputs>
        <data name="plot" format="png" from_work_dir="plot.png"/>
    </outputs>
    <tests>
        <test expect_num_outputs="1">
            <param name="prj_file" value="PtSn_OCO_Abu_1.prj"/>
            <param name="component_file" value="Sn_foil_extracted.prj"/>
            <param name="component_file" value="SnO2_extracted.prj"/>
            <output name="plot">
                <assert_contents>
                    <has_size value="62600" delta="100"/>
                </assert_contents>
            </output>
        </test>
        <test expect_num_outputs="1">
            <param name="prj_file" value="PtSn_OCO_Abu_1.prj"/>
            <param name="component_file" value="Sn_foil.prj"/>
            <param name="extract_group" value="merge"/>
            <param name="component_file" value="SnO2.prj"/>
            <param name="extract_group" value="SnO2_0_9_2_6_13_5_0_8_1_0_with_theory"/>
            <output name="plot">
                <assert_contents>
                    <has_size value="64200" delta="100"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        Performs a Linear Combination Fit (LCF) on an Athena project, using a number of other projects as components to the fit.
        The extent to which each component contributes to the target is recorded in the output plot of the normalised absorption co-efficient.
    ]]></help>
    <citations>
        <citation type="doi">@TOOL_CITATION@</citation>
        <citation type="doi">10.1107/S0909049505012719</citation>
    </citations>
</tool>